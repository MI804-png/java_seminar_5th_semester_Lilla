<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" 
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" 
      layout:decorate="~{fragments/layout}">

<div layout:fragment="content">
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">
                <i class="fas fa-users"></i> User Management
            </h3>
        </div>
        
        <div class="table-responsive">
            <table class="table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Username</th>
                        <th>Email</th>
                        <th>Full Name</th>
                        <th>Role</th>
                        <th>Created At</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="user : ${users}">
                        <td th:text="${user.id}">1</td>
                        <td>
                            <strong th:text="${user.username}">username</strong>
                        </td>
                        <td th:text="${user.email}">email@example.com</td>
                        <td th:text="${user.fullName}">Full Name</td>
                        <td>
                            <span class="badge" 
                                  th:classappend="${user.role.name() == 'ADMIN'} ? 'badge-danger' : 'badge-primary'"
                                  th:text="${user.role}">ROLE</span>
                        </td>
                        <td th:text="${#temporals.format(user.createdAt, 'yyyy-MM-dd HH:mm')}">2025-01-01 12:00</td>
                        <td>
                            <button class="btn btn-sm btn-info" 
                                    th:attr="data-id=${user.id},data-username=${user.username},data-email=${user.email},data-fullname=${user.fullName},data-role=${user.role}"
                                    onclick="viewUser(this.getAttribute('data-id'), this.getAttribute('data-username'), this.getAttribute('data-email'), this.getAttribute('data-fullname'), this.getAttribute('data-role'))">
                                <i class="fas fa-eye"></i> View
                            </button>
                            <form th:action="@{/admin/users/{id}/delete(id=${user.id})}" method="post" style="display:inline;" 
                                  th:attr="data-username=${user.username}"
                                  onsubmit="return confirm('Are you sure you want to delete user ' + this.getAttribute('data-username') + '?');">
                                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                                <button type="submit" class="btn btn-sm btn-danger">
                                    <i class="fas fa-trash"></i> Delete
                                </button>
                            </form>
                        </td>
                    </tr>
                    <tr th:if="${#lists.isEmpty(users)}">
                        <td colspan="7" class="text-center">
                            <i class="fas fa-info-circle"></i> No users found in the system.
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <div class="card-footer">
            <div class="row">
                <div class="col-6">
                    <p><strong>Total Users:</strong> <span th:text="${#lists.size(users)}">0</span></p>
                </div>
                <div class="col-6 text-right">
                    <a th:href="@{/register}" class="btn btn-success">
                        <i class="fas fa-user-plus"></i> Add New User
                    </a>
                    <a th:href="@{/admin/users/export}" class="btn btn-primary">
                        <i class="fas fa-download"></i> Export CSV
                    </a>
                </div>
            </div>
        </div>
    </div>
    
    <!-- User Statistics -->
    <div class="row">
        <div class="col-4">
            <div class="card">
                <div class="card-header">
                    <h4><i class="fas fa-chart-pie"></i> User Roles</h4>
                </div>
                <div class="stats-list">
                    <div class="stat-item">
                        <span>Admin Users:</span>
                        <strong th:text="${#lists.size(users.?[role.name() == 'ADMIN'])}">0</strong>
                    </div>
                    <div class="stat-item">
                        <span>Registered Users:</span>
                        <strong th:text="${#lists.size(users.?[role.name() == 'REGISTERED'])}">0</strong>
                    </div>
                    <div class="stat-item">
                        <span>Visitor Users:</span>
                        <strong th:text="${#lists.size(users.?[role.name() == 'VISITOR'])}">0</strong>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-4">
            <div class="card">
                <div class="card-header">
                    <h4><i class="fas fa-user-check"></i> User Activity</h4>
                </div>
                <div class="stats-list">
                    <div class="stat-item">
                        <span>Active Today:</span>
                        <strong>0</strong>
                    </div>
                    <div class="stat-item">
                        <span>Active This Week:</span>
                        <strong>0</strong>
                    </div>
                    <div class="stat-item">
                        <span>Active This Month:</span>
                        <strong th:text="${#lists.size(users)}">0</strong>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-4">
            <div class="card">
                <div class="card-header">
                    <h4><i class="fas fa-info-circle"></i> Quick Actions</h4>
                </div>
                <div class="action-links">
                    <a href="#" onclick="event.preventDefault(); bulkEditUsers();" class="action-link">
                        <i class="fas fa-users-cog"></i> Bulk Edit Users
                    </a>
                    <a href="#" onclick="event.preventDefault(); sendNotifications();" class="action-link">
                        <i class="fas fa-envelope"></i> Send Notifications
                    </a>
                    <a href="#" onclick="event.preventDefault(); generateReport();" class="action-link">
                        <i class="fas fa-file-pdf"></i> Generate Report
                    </a>
                    <a th:href="@{/admin}" class="action-link">
                        <i class="fas fa-arrow-left"></i> Back to Dashboard
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<th:block layout:fragment="scripts">
    <script>
        function viewUser(userId, username, email, fullName, role) {
            const message = `User Details:\n\nID: ${userId}\nUsername: ${username}\nEmail: ${email}\nFull Name: ${fullName}\nRole: ${role}`;
            alert(message);
        }
        
        function bulkEditUsers() {
            showAlert('Bulk edit feature: Select multiple users and apply changes to all at once', 'info');
        }
        
        function sendNotifications() {
            showAlert('Send email notifications to all users about system updates', 'info');
        }
        
        function generateReport() {
            showAlert('Generate PDF report with user statistics and activity logs', 'info');
        }
    </script>
    
    <style>
        .badge {
            padding: 0.35rem 0.65rem;
            border-radius: 12px;
            font-weight: 600;
            font-size: 0.75rem;
            text-transform: uppercase;
        }
        
        .badge-primary {
            background-color: #3498db;
            color: white;
        }
        
        .badge-danger {
            background-color: #e74c3c;
            color: white;
        }
        
        .stats-list {
            padding: 1rem;
        }
        
        .stat-item {
            display: flex;
            justify-content: space-between;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            background-color: #f8f9fa;
            border-radius: 6px;
        }
        
        .stat-item span {
            color: #666;
        }
        
        .stat-item strong {
            color: var(--primary-color);
            font-size: 1.1rem;
        }
        
        .action-links {
            padding: 1rem;
        }
        
        .action-link {
            display: block;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            background-color: #f8f9fa;
            border-radius: 6px;
            text-decoration: none;
            color: var(--text-color);
            transition: all 0.3s;
        }
        
        .action-link:hover {
            background-color: var(--primary-color);
            color: white;
            transform: translateX(5px);
        }
        
        .action-link i {
            margin-right: 0.5rem;
            width: 20px;
        }
        
        .btn-sm {
            padding: 0.25rem 0.5rem;
            font-size: 0.875rem;
        }
        
        .text-right {
            text-align: right;
        }
    </style>
</th:block>

</html>
